# API для Clarity Project

[Опис API](README.md)

### Інформація про юридичні особи та ФОП

## edr.search
Метод повертає результати пошуку ю/о та ФОП за запитом, який передається у параметрі `q`

##### Параметри:
* **q** - пошуковий запит;
* **page** - сторінка результатів;

##### Приклад запиту:
[https://clarity-project.info/api/edr.search/?q=дп прозорро&key=xxx]()

##### Приклад відповіді:
```json
{
  "paginator": {
    "total_found": "3",
    "current_page": 1,
    "total_pages": 1
  },
  "list": [
    {
      "Edr": "02426097",
      "Name": " ДП \"ПРОЗОРРО\"",
      "Address": "Київська область, Київ, вул Бульварно-Кудрявська (Воровського), 22",
      "Source": "edr",
      "SourceName": "ЄДР",
      "RecordType": "name",
      "RecordTypeName": "Назва"
      // ...
    },
    {
      "Edr": "42068925",
      "Name": "ДЕРЖАВНЕ ПІДПРИЄМСТВО \"ПРОЗОРРО.ПРОДАЖІ\"",
      "Address": "м. Київ, м. Київ, вул. Бульварно-Кудрявська, 22",
      // ...
    },
    // ...
  ]
}
```

##### Опис полів:
* **Edr** - код за ЄДРПОУ або *false*;
* **FopID** - ID [запису ФОП](fop.info.md#fopinfo) або *false*;
* **Name** - назва/ПІБ;
* **Source, SourceName** - джерело інформації;

## edr.changes
Метод повертає юридичних осіб списком по даті їх останнього оновлення (від старих до нових). 
Сюди також входять нові зареєстровані юрособи.

Метод може використовуватись для підтримання актуальності даних на стороні клієнта.

**Важливо:**
- *дата оновлення* означає дату, коли ми зафіксували зміни в своїй БД. 
  Тобто, це може бути не фактична *дата зміни* в ЄДР;
- дата змінюється тільки при оновленні даних ЄДР. Якщо у компанії змінились інші дані 
  (з Prozorro, податкової тощо) - її дата не оновиться.

##### Приклад запиту:
https://clarity-project.info/api/edr.changes?key=xxx&offset=2024-01-01 - поверне 
250 юридичних осіб, які оновились з 1 січня 2024 року (визначається параметром `offset`).

Після чого можна взяти `ChangedAt` останньої компанії зі списку і зробити запит 
з новим `offset`. Якщо у відповіді буде менше *250* результатів - запити можна припинити. 

##### Приклад відповіді:
```json
{
  "items": [
    {
      "Edr": "20524082",
      "ChangedAt": "2023-12-06 14:54:12",
      "DataHash": "b1179c629c42415acfd78b7f0d394ea81816f18d"
    },
    {
      "Edr": "32189060",
      "ChangedAt": "2023-12-08 12:49:14",
      "DataHash": "530375d4748377f6a5b837be176cce550968b389"
    },
    // ...
  ]
}
```

## edr.info
Метод повертає інформацію по юридичній особі або ФОП за їх кодом ЄДРПОУ/РНОКПП.

**Важливо:** інформація за кодом РНОКПП доступна лише для ФОП-учасників закупівель Prozorro.

##### Приклад запиту:
https://clarity-project.info/api/edr.info/14360570?key=xxx,
де **14360570** - код за ЄДРПОУ.

##### Приклад відповіді: 
[examples/edr.info.json](examples/edr.info.json)

##### Опис полів:
* **edr, name** - код та назва [1];
* **address** - адреса [1];
* **contact** - контактна особа (Prozorro) [1];
* **isTenderer, isBuyer** - true, якщо це учасник або замовник [1];
* **edr_data** - інформація з ЄДР (якщо доступна):
    * **edr, name, shortName** - код, повна та коротка назви
    * **opf, opf_name** - код та назва коду організаційно-правової форми;
    * **address, address_parts** - повна адреса та адреса, очищена та розбита на складові;
    * **status, statusName** - стан ю/о;
    * **capital** - статутний капітал;
    * **activity** - перелік видів діяльності за КВЕД;
    * **founders, beneficiaries** - переліки засновників та бенефіціарів;
    * **signers** - перелік осіб з правом підпису;
    * **branches** - перелік філій;
    * **predecessors** - перелік правонаступників;
    * **contacts** - контакти;
    * **registration, termination** - дата (unix-timestamp) та номер реєстрації та припинення ю/о;
* **history** - кількість записів в історіі змін (див. edr.history);
* **licenses_count** - кількість ліцензій;
* **vat** - інформація про стан платника ПДВ, *null* або об'єкт:
    * **VatNumber** - ІПН;
    * **DfsCode** - код ДПІ;
    * **RegDate** - дата реєстрації платником;
    * **CancelDate** - дата анулювання;
    * **CancelReason**, **CancelOperation** - причина анулювання статусу платника;
    * **Updated** - дата оновлення запису в базі даних (актуальність запису);
* **tax_debt** - податковий борг;
* **non_profit** - інформація про стан неприбутковості, *null* або об'єкт:
    * **sfs_edr**, **sfs_name** - код та назва органу ДПС;
    * **reg_date** - дата включення до Реєстру неприбуткових установ та організацій;
    * **cancel_date** - дата скасування ознаки неприбутковості;
    * **non_profit_date** - дата присвоєння або зміни ознаки неприбутковості;
    * **non_profit_code**, **non_profit_name** - ознака неприбутковості;
    * **decisions_num**, **decisions_date**, **decisions** - інформація про рішення про присвоєння/скасування ознаки;
* **single_tax** - інформація про стан платника єдиного податку, *null* або об'єкт:
    * **rate** - ставка податку;
    * **group** - група;
    * **date_reg** - дата реєстрації платником;
    * **date_reg** - дата припинення реєстрації або *null*;
    * **activities** - перелік видів діяльності;
    * **updated_at** - дата оновлення інформації;
* **tenderer_stats** - інформація про учасника Prozorro:
    * **participations** - участі в закупівлях;
    * **awards** - перемоги;
    * **contracts** - контракти;
* **available_finances** - список періодів, за які наявні фінансови звіти компанії (див. метод [edr.finances](edr.finances.md));
* **owned** - інформація про власність:
    * **vehicle** - кількість автомобілів у користуванні;
* **buyer_stats** - інформація про замовника Prozorro;
* **treasury_stats** - інформація про транзакції Казначейства:
    * **payer, payee** - сума та кількість транзакція як платник та отримувач коштів відповідно; 

**[1]** - в цих полях повертається інформація з системи Prozorro, якщо вона доступна для запитуваної ю/о.

## edr.info/licenses

Метод повертає інформацію про наявні ліцензії за кодом ЄДРПОУ.

##### Приклад запиту:
https://clarity-project.info/api/edr.info/14360570/licenses?key=xxx,
де **14360570** - код за ЄДРПОУ.

##### Приклад відповіді:
```json
{
  "list": [
    {
      "license_id": "2158.18.32",
      "registry": "Реєстр дозволів на виконання робіт підвищеної небезпеки та на експлуатацію (застосування) машин, механізмів, устаткування підвищеної небезпеки",
      "date_start": "1533070800",
      "date_end": "1690837200",
      "activity": "Експлуатація машин, механізмів, устаткування: Устатковання та технічні засоби для виготовлення, використання і транспортування вибухових матеріалів і виробів на їх основі, комплекси для їх переробки та зберігання",
      "authority": "Держгірпромнагляд України, Територіальне управління по Київської області і м. Києва",
      "comment": ""
    },
    //...
  ]
}
```

## edr.info/persons

Метод повертає інформацію про пов'язаних фізичних осіб.

##### Приклад запиту:
https://clarity-project.info/api/edr.info/14360570/persons?key=xxx,
де **14360570** - код за ЄДРПОУ.

**Додаткові параметри:**
* **page** - сторінка результатів;
* **type** - тип особи;

##### Приклад відповіді:
```json
{
  "paginator": {
    "total_found": "2649",
    "current_page": 1,
    "total_pages": 27
  },
  "list": [
    {
      "Name": "СЕРГІЙ МИКОЛАЙОВИЧ МАКАРЕНКО",
      "Hash": "55eb516b5e954e9f21e5b5e62ce8b88c",
      "Type": "contact",
      "Actual": "1",
      "SourceType": "limited",
      "Updated": "1642002121",
      "ContactPhone": "+380737161131",
      "TypeName": "Контакт",
      "SourceName": "Неконкурентні закупівлі"
    },
    {
      "Name": "МОСТОВЕНКО ІГОР ВОЛОДИМИРОВИЧ",
      "Hash": "57e2d270a2af8d387715eb9fac494376",
      "Type": "contact",
      "Actual": "1",
      "SourceType": "limited",
      "Updated": "1642000221",
      "ContactPhone": "0992908336",
      "TypeName": "Контакт",
      "SourceName": "Неконкурентні закупівлі"
    },
    // ...
  ]
}
```
##### Опис полів:
* **Name** - ПІБ;
* **Type, TypeName** - тип особи;
* **Actual** - 1, якщо запис актуальний, 0, якщо запис з історії;
* **SourceType, SourceName** - джерело інформації;
* **Updated** - дата (unix timestamp) актуальності запису;

## edr.info/treasury

Метод повертає інформацію про транзакції Казначейства.

##### Приклад запиту:
https://clarity-project.info/api/edr.info/26510514/treasury?key=xxxx,
де **26510514** - код за ЄДРПОУ.

##### Приклад відповіді:
```json
{
  "is_payee": true,
  "is_payer": true,
  "bank_accounts": [
    {
      "Account": "344290031000030401",
      "Mfo": "820172",
      "Updated": "2021-12-21",
      "BankEdr": "37567646",
      "BankName": "Державна казначейська служба України, м.Київ"
    },
    // ...
  ],
  "by_date": [
    {
      "Date": "2015-09",
      "PayerAmount": 1436596.17,
      "PayerCount": 37,
      "PayeeAmount": 197260.84,
      "PayeeCount": 7
    },
    // ...
  ]
}
```
##### Опис полів:
* **is_payee, is_payer** - true, якщо отримувач коштів або якщо платник відповідно;
* **bank_accounts** - перелік банківських рахунків, які використувувались цією ю/о:
    * **Account, Mfo** - номер рахунку та МФО банку;
    * **BankEdr, BankName** - назва та код банку;
    * **Updated** - дата актуальності;
* **by_date** - помісячна статистика руху коштів: 
    * **Date** - рік та місяць;
    * **PayerAmount, PayerCount** - сума та кількість транзакцій, де ю/о платник;
    * **PayeeAmount, PayeeCount** - сума та кількість транзакцій, де ю/о отримувач коштів;


## edr.info/vehicles

Метод повертає інформацію автотранспорт у користуванні за кодом ЄДРПОУ.

##### Приклад запиту:
https://clarity-project.info/api/edr.info/14360570/vehicles?key=xxx,
де **14360570** - код за ЄДРПОУ.

##### Приклад відповіді:
```json
{
  "entity": {
    "edr": "14332102"
  },
  "vehicles": [
    {
      "LicenseIssue": "2007-03-06",
      "LicenseStart": "2007-03-01",
      "LicenseEnd": "2012-02-29",
      "LicenseStatus": "Недійсна",
      "VehicleCert": "Тимчасовий реєстраційний талон",
      "VehicleStatus": "Звичайний",
      "VehicleType": "Фургон",
      "VehicleNum": "АА6737АН",
      "VehicleVendor": "Марка?",
      "VehicleModel": "Volkswagen Caddy SDI",
      "VehicleLoad": "0",
      "VehicleSeats": null,
      "VehicleYear": "2005",
      "VINCode": null,
      "Updated": 1541760645,
      "Created": 1548321270
    }, 
    // ...
  ]
}
```
##### Опис полів:
* **LicenseIssue**, **LicenseStart**, **LicenseEnd** - дати видачі, початку і закінчення дії ліцензії;
* **LicenseStatus** - стан ліцензії;
* **VehicleType** - тип авто; 
* **VehicleNum** - реєстраційний номер;
* **VehicleVendor**, **VehicleModel** - виробник і марка; 
* **VehicleYear** - рік випуску;
* **VINCode** - vin-код;
* **Updated**, **Created** - дати (unix-timestamp) останнього оновлення і створення запису; 

## edrpou.history

Метод повертає історію змін в ЄДР для юридичної особи за її кодом.

##### Приклад запиту:
https://clarity-project.info/api/edrpou.history/43007203?key=xxx,
де **43007203** - код за ЄДРПОУ.

##### Приклад відповіді:
[examples/edrpou.history.json](examples/edrpou.history.json)

## edr.history

Повертає історію змін даних з системи Prozorro за кодом ЄДРПОУ.

**Зверніть увагу:** формат запитів та відповідей для цього методу буде змінено в майбутньому.

##### Приклад запиту:
https://clarity-project.info/api/edr.history/02147629?key=xxx,
де **02147629** - код за ЄДРПОУ.

##### Приклад відповіді:
```json
{
  "history": [
    {
      "edr": "02147629",
      "name": "Департамент освіти і науки виконавчого органу Київської міської ради (Київської міської державної адміністрації)",
      "modified": "1640770515",
      "address": {
        "postal": "01004",
        "country": "Україна",
        "region": "м. Київ",
        "region_code": "kvm",
        "locality": "м. Київ",
        "address": "БУЛЬВАР ТАРАСА ШЕВЧЕНКА, будинок 3"
      },
      "contact": {
        "name": "Сорокун Римма Вікторівна",
        "email": "education@kyivcity.gov.ua",
        "phone": "380442792597",
        "fax": "",
        "web": ""
      },
      "source": "open",
      "tender": [
        "289e1243598f42759722432b5384789c",
        "Ноутбук: HP 245 G8 (27J56EA) Dark Ash Silver"
      ]
    },
    //...
  ]
}
```

##### Опис полів:
* **edr** - код за ЄДРПОУ;
* **name** - назва;
* **address** - адреса;
* **contact** - контактна інформація;
* **source** - тип джерела, open - відкриті торги, limited - звіти;
* **modified** - дата (unix-timestamp) актуальності;
* **tender** - ID та назва закупівлі-джерела даних;

## edr.relations

Повертає пов'язані компанії.

##### Приклад запиту:

https://clarity-project.info/api/edr.relations/35601826?key=xxxx,
де **35601826** - код за ЄДРПОУ.

##### Приклад відповіді:
```json
{
  "relations": {
    "Person": [
      {
        "Edr": "23785896",
        "SourceFrom": "edr",
        "SourceTo": "edr",
        "Person": "Дмитренко Олександр Миколайович"
      }
      // ...
    ],
    "Phone": [
      {
        "Edr": "00034186",
        "SourceFrom": "prozorro-sale",
        "SourceTo": "prozorro-sale",
        "Phone": "380678294075"
      }
      // ...
    ]
  },
  "edrs": {
    "23785896": {
      "Name": "ПРИВАТНЕ ПІДПРИЄМСТВО \"ДАНКО\"",
      "Edr": "23785896"
    },
    "00034186": {
      "Name": "ПУБЛІЧНЕ АКЦІОНЕРНЕ ТОВАРИСТВО \"НАЦІОНАЛЬНА АКЦІОНЕРНА СТРАХОВА КОМПАНІЯ \"ОРАНТА\"",
      "Edr": "00034186"
    }, 
    // ...
  }
}
```

##### Опис полів:
В ключі **relations** повертаються пов'язані особи відповідно до категорій. 

Можливі категорії:
* **Person** - зв'язок за ПІБ особи;
* **Address** - збіг за адресою;
* **Email** - збіг контактного е-мейлу;
* **Phone** - збіг контактного телефону;
* **Founder** - зв'язок між засновником та дочірнім підприємством;

В ключі **edrs** - код та назва пов'язаної особи.


