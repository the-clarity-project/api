# API для clarity-project.info

Все методы API вызываются с помощью GET-запроса по URL http://clarity-project.info/api/*method* и возвращают ответ в формате JSON.

В заголовке **X-API-VERSION** возвращается версия API.

В случае ошибки, возвращается объект с единственным ключом **error**, содержащим подробности ошибки.

В каждом успешном запросе содержится объект **stats**, содержащий время его выполнения.

### Методы:
#### /edr.info/*ЕГРПОУ*
Возвращает информацию о ЕГРПОУ/ИНН.

Например: /api/edr.info/04526727

Значения основных полей очевидны, **isBuyer** равняется **true**, если этот ЕГРПОУ создавал тендеры, **isTenderer** — если принимал участие (делал предложения, получал награды или контракты, не важно, были ли они отменены или нет).

#### /edr.search
Поиск по ЕГРПОУ.

Например: /api/edr.search?q=фоп

GET-параметры: 
* q — запрос;
* page — страница результатов.

Возвращает объект с ключами **paginator** — информация о результатах поиска и **list** — список в том же формате, что и **edr.info**, без полей isBuyer и isTenderer.

**Важно:**
Поиск реально медленный, и занимает **15+ секунд**, иногда просто падая с 504 ошибкой.

#### /edr.history/*ЕГРПОУ*
Возвращает историю изменений информации о ЕГРПОУ.

GET-параметры:
* **categories** — если **1**, то показывать в виде категорий, иначе в виде хронологии. 

#### /edr.relations/*ЕГРПОУ*
Возвращает связи для ЕГРПОУ.

#### /tender.search
Поиск по тендерам. 

Возвращает тендеры по фильтру. 

GET-параметры в том же формате, что и при запросе из [интерфейса](http://clarity-project.info/tenders).
* **text** — поиск по тексту в описании или заголовке тендера;
* **entity** — ЕГРПОУ заказчика;
* **tenderer** — ЕГРПОУ участника;
* **classification** — CPV-код закупки. Из-за бага сейчас от него отрезаются нули, то есть, **30000000-9** становится **3**. Ищется по wildcard, **3411** = **3411....**.
* **tenderer_status** — **tenderer** (сделал ставку), **supplier** (победил), **contractor** (подписан контракт);
* **date_from** и **date_to** — даты последнего обновления данных в тендере, от-до, в формате **dd-mm-yyyy**;
* **value_min** и **value_max** — диапазон **планируемой** цены закупки;
* **method** — открытые/неконкурентные, **open** или **limited**;
* **complaints** — если **1**, то фильтрует по наличию жалоб на тендер;
* **complaint_from** — от кого жалоба, ЕГРПОУ;
* **status** — статус тендера, **active**, **complete**, **unsuccessful**, **cancelled**;
* **region** — область, в которой находится закупщик;
* **sort** — **Modified** (от новых к старым), **Value** (от дорогих к дешевым), **Economy** (по экономии);
* **offset** — сколько тендеров пропустить сверху списка.

Поскольку **tender.search** не возвращает объект **paginator**, то пагинация реализуется с помощью параметра **offset**. Если тендеры под фильтрами закончились, метод вернёт пустой массив.

**Важно:**
Из-за бага (я буду звать это фичей) offset не работает, если не были переданы другие фильтры. 

#### contracts.get
Возвращает контракты (в любом статусе: подписанные, предложенные, отмененные) по фильтрам.

* **buyer** — ЕГРПОУ закупщика;
* **contractor** — ЕГРПОУ продавца;
* **page** — страница результатов.

### Ограничения и безопасность
На сейчас на API существует ограничение в 1 запрос/сек. 

Кроме этого, все вызовы к API логгируются для отладки и статистики, **включая IP-адрес клиента**. 
